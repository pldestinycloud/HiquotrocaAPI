@page "/sorteio-detalhes"
@inject NavigationManager NavManager

@code {
    [Parameter] public string Produto { get; set; } = "";
    [Parameter] public string Imagem { get; set; } = "";
    [Parameter] public int TotalNumeros { get; set; }
    [Parameter] public int NumerosSelecionados { get; set; }
    [Parameter] public string MeusNumeros { get; set; } = "";
    [Parameter] public string DataSorteio { get; set; } = "";

    protected override void OnInitialized()
    {
        var uri = NavManager.ToAbsoluteUri(NavManager.Uri);

        var queryParams = uri.Query
            .TrimStart('?')
            .Split('&', StringSplitOptions.RemoveEmptyEntries)
            .Select(p => p.Split('='))
            .ToDictionary(
                kv => Uri.UnescapeDataString(kv[0]),
                kv => kv.Length > 1 ? Uri.UnescapeDataString(kv[1]) : ""
            );

        Produto = queryParams.GetValueOrDefault("produto", "");
        Imagem = queryParams.GetValueOrDefault("imagem", "images/default.png");
        MeusNumeros = queryParams.GetValueOrDefault("meus", "");
        DataSorteio = queryParams.GetValueOrDefault("data", "");

        TotalNumeros = int.TryParse(queryParams.GetValueOrDefault("total", "0"), out var t) ? t : 0;
        NumerosSelecionados = int.TryParse(queryParams.GetValueOrDefault("usados", "0"), out var u) ? u : 0;
    }
}
