@page "/perfil"
@inject NavigationManager Nav

    <MudContainer MaxWidth="MaxWidth.Small" Class="pa-6"
                  Style="background-color:white;border:none;box-shadow:none;border-radius:0;margin-top:10px;margin-bottom:50px;position:relative;">

        <!-- 🔙 Botão Voltar -->
        <MudIconButton Icon="@Icons.Material.Filled.ArrowBack"
                       Color="Color.Default"
                       Size="Size.Medium"
                       OnClick="@Voltar"
                       Style="position:absolute;top:10px;left:10px;cursor:pointer;" />

        <!-- Título -->
        <MudText Typo="Typo.h4" Align="Align.Center" Color="Color.Warning" Class="mb-4 mt-2">
            Perfil
        </MudText>

        <!-- FOTO DE PERFIL -->
        <div class="d-flex justify-center mb-4">
            <label style="cursor:pointer;">
                <InputFile OnChange="OnFotoSelecionada" accept="image/*" style="display:none;" />
                <div style="position:relative; display:inline-block;">
                    <img src="@(_foto ?? "images/User.png")"
                         style="width:110px;height:110px;border-radius:50%;object-fit:cover;border:2px solid #bbb;background-color:#f5f5f5;" />
                    <div style="position:absolute;bottom:2px;right:2px;background-color:white;border:1px solid #ccc;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;">
                        <MudIcon Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Warning" />
                    </div>
                </div>
            </label>
        </div>

        <!-- INFORMAÇÃO PESSOAL -->
        <MudText Typo="Typo.subtitle1" Class="mb-2" Color="Color.Default" Style="font-weight:600;">
            Informação Pessoal
        </MudText>

        <div class="d-flex gap-2 mb-2">
            <MudTextField T="string" Label="Nome" Variant="Variant.Outlined" Class="flex-1" Placeholder="Nome" />
            <MudTextField T="string" Label="Apelido" Variant="Variant.Outlined" Class="flex-1" Placeholder="Apelido" />
        </div>

        <MudTextField T="string" Label="Data de Nascimento" InputType="InputType.Date" Variant="Variant.Outlined" FullWidth="true" />

        <!-- Telefone -->
        <MudText Typo="Typo.caption" Class="mt-4 mb-n1" Style="color:#444;">Número de Telefone</MudText>
        <div style="display:flex;align-items:center;gap:8px;margin-top:6px;">
            <MudSelect T="string" Variant="Variant.Outlined" Class="w-25" Style="min-width:80px;" Placeholder="🇵🇹 +351">
                <MudSelectItem T="string">🇵🇹 +351</MudSelectItem>
                <MudSelectItem T="string">🇦🇴 +244</MudSelectItem>
                <MudSelectItem T="string">🇧🇷 +55</MudSelectItem>
                <MudSelectItem T="string">🇲🇿 +258</MudSelectItem>
            </MudSelect>
            <MudTextField T="string" Placeholder="912345678" Variant="Variant.Outlined" FullWidth="true" />
        </div>

        <MudTextField T="string" Label="Email" Variant="Variant.Outlined" FullWidth="true" Placeholder="email@gmail.com" Class="mt-3" />
        <MudTextField T="string" Label="Palavra-passe" Variant="Variant.Outlined" FullWidth="true" InputType="InputType.Password" Placeholder="********" Class="mt-3" />

        <MudLink Href="#" Align="Align.Right" Color="Color.Warning" Class="d-block mt-1 mb-3">Alterar palavra-passe</MudLink>

        <MudDivider Class="my-4" />

        <!-- DETALHES DA MORADA -->
        <MudText Typo="Typo.subtitle1" Class="mb-2" Color="Color.Default" Style="font-weight:600;">
            Detalhes da Morada
        </MudText>

        <MudTextField T="string" Label="Pincode" Variant="Variant.Outlined" FullWidth="true" Placeholder="Pincode"/>
        <MudTextField T="string" Label="Morada" Variant="Variant.Outlined" FullWidth="true" Placeholder="Morada" />
        <MudTextField T="string" Label="Código Postal" Variant="Variant.Outlined" FullWidth="true" Placeholder="XXXX-XXX" />
        <MudTextField T="string" Label="Cidade" Variant="Variant.Outlined" FullWidth="true" Placeholder="Escolhe" />
        <MudTextField T="string" Label="Distrito" Variant="Variant.Outlined" FullWidth="true" Placeholder="Distrito" />
        <MudSelect T="string" Label="País" Variant="Variant.Outlined" FullWidth="true" Placeholder="Afeganistão">
            <MudSelectItem T="string">Afeganistão</MudSelectItem>
            <MudSelectItem T="string">Portugal</MudSelectItem>
            <MudSelectItem T="string">Brasil</MudSelectItem>
            <MudSelectItem T="string">Angola</MudSelectItem>
            <MudSelectItem T="string">Moçambique</MudSelectItem>
        </MudSelect>

        <MudDivider Class="my-4" />

        <!-- DETALHES DA CONTA BANCÁRIA -->
        <MudText Typo="Typo.subtitle1" Class="mb-2" Color="Color.Default" Style="font-weight:600;">
            Detalhes da Conta Bancária
        </MudText>

        <MudTextField T="string" Label="Número de Conta Bancária" Variant="Variant.Outlined" FullWidth="true" Placeholder="XXXXXXXXXXX" />
        <MudTextField T="string" Label="Titular da Conta" Variant="Variant.Outlined" FullWidth="true" Placeholder="Titular" />
        <MudTextField T="string" Label="Código SWIFT/BIC" Variant="Variant.Outlined" FullWidth="true" Placeholder="XXXXXXXXX" />
        <MudTextField T="string" Label="NIF" Variant="Variant.Outlined" FullWidth="true" Placeholder="XXXXXXXXX" Class="mb-4" />

        <!-- BOTÃO -->
        <MudButton Variant="Variant.Filled" Color="Color.Warning" FullWidth="true"
                   Class="py-2 mt-2"
                   Style="text-transform:none;font-weight:bold;border-radius:10px;">
            Salvar
        </MudButton>

        <div style="text-align:center;margin-top:25px;">
            <MudButton Variant="Variant.Filled" Color="Color.Warning" OnClick="@IrParaLogin">
                Perfil
            </MudButton>
        </div>

    </MudContainer>

@code {
    private string? _foto;

    void IrParaLogin()
    {
        Nav.NavigateTo("/start");
    }

    private void Voltar()
    {
        Nav.NavigateTo("/");
    }

    private async Task OnFotoSelecionada(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file == null) return;

        using var stream = file.OpenReadStream(maxAllowedSize: 10_000_000);
        using var ms = new MemoryStream();
        await stream.CopyToAsync(ms);
        var bytes = ms.ToArray();

        var base64 = Convert.ToBase64String(bytes);
        _foto = $"data:{file.ContentType};base64,{base64}";
    }
}